from flask import Flask, request, jsonify
import numpy as np

app = Flask(__name__)

likelihoods =[
    [0.0250, 0.8813, 0.0250, 0.0563, 0.0250, 0.0250, 0.1188, 0.0250, 0.0875, 0.9438, 0.7625, 0.0250, 0.0563, 0.1750,
     0.0563],
    [0.9438, 0.7938, 0.0563, 0.0563, 0.0250, 0.0250, 0.5000, 0.8813, 0.3250, 0.9125, 0.7625, 0.0875, 0.0250, 0.8813,
     0.5875],
    [0.0563, 0.9438, 0.0250, 0.1500, 0.0250, 0.0250, 0.0563, 0.0250, 0.4125, 0.9125, 0.8250, 0.0563, 0.0250, 0.7938,
     0.0875],
    [0.0875, 0.9125, 0.0250, 0.0250, 0.0250, 0.0250, 0.9750, 0.0563, 0.5000, 0.9125, 0.8813, 0.6750, 0.0563, 0.9125,
     0.9125],
    [0.1188, 0.9438, 0.0563, 0.0250, 0.9750, 0.8250, 0.0250, 0.0563, 0.1750, 0.9125, 0.7938, 0.6188, 0.0250, 0.9438,
     0.9125],
    [0.3250, 0.7938, 0.9750, 0.0875, 0.1750, 0.0250, 0.6750, 0.0563, 0.5875, 0.9125, 0.7625, 0.2938, 0.0250, 0.8813,
     0.5000],
    [0.7938, 0.3250, 0.0250, 0.2938, 0.5000, 0.0250, 0.0250, 0.6750, 0.0250, 0.0250, 0.8813, 0.7063, 0.9438, 0.9125,
     0.9438],
    [0.2639, 0.9056, 0.3694, 0.0500, 0.1722, 0.0778, 0.2111, 0.1444, 0.5667, 0.9333, 0.8917, 0.3278, 0.0500, 0.8667,
     0.7750],
    [0.1861, 0.8917, 0.0250, 0.0250, 0.1194, 0.0528, 0.3306, 0.1056, 0.8250, 0.8667, 0.8917, 0.0250, 0.0700, 0.8389,
     0.5500],
    [0.3556, 0.3694, 0.0917, 0.0917, 0.2111, 0.1306, 0.8667, 0.0528, 0.1861, 0.2250, 0.5667, 0.1000, 0.2750, 0.5139,
     0.7083],
    [0.0563, 0.9125, 0.0250, 0.0250, 0.0250, 0.0250, 0.9750, 0.0250, 0.4125, 0.9438, 0.7063, 0.5000, 0.8500, 0.9125,
     0.9125],
    [0.7063, 0.5000, 0.0250, 0.2063, 0.7938, 0.3250, 0.1750, 0.0250, 0.0250, 0.0563, 0.9438, 0.9438, 0.6750, 0.9125,
     0.9438],
    [0.0250, 0.9125, 0.3250, 0.1750, 0.0250, 0.0250, 0.2938, 0.0250, 0.0250, 0.4125, 0.1750, 0.0250, 0.0250, 0.0563,
     0.0563],
    [0.9125, 0.7938, 0.0250, 0.0875, 0.2063, 0.0250, 0.4125, 0.0875, 0.9750, 0.5875, 0.9125, 0.9125, 0.0250, 0.9125,
     0.9750],
    [0.2063, 0.3250, 0.0250, 0.0563, 0.0250, 0.0250, 0.9438, 0.0250, 0.9438, 0.5000, 0.8813, 0.8813, 0.0250, 0.9125,
     0.9438],
    [0.7938, 0.1188, 0.9750, 0.9438, 0.8806, 0.9750, 0.6694, 0.9438, 0.5875, 0.0875, 0.1750, 0.6722, 0.9500, 0.1188,
     0.2250]]

priorLikelihoods = np.full(shape = 16, fill_value= 6.25, dtype=float)



@app.route('/')
def hello_world():
    return 'yo'


@app.route('/diagnose', methods=['POST'])
def diagnose():
    data = request.get_json()
    shown_symptoms = data['symptoms']
    results = []
    for x in range(len(likelihoods)):
        chainProbability = 1.0
        for y in range(len(likelihoods[0])):
            likelihood = 1
            if shown_symptoms[y] == 1:
                likelihood = likelihoods[x][y]
            elif shown_symptoms[y] == -1:
                likelihood = 1 - likelihoods[x][y]
            chainProbability *= likelihood
            posterior = chainProbability * priorLikelihoods[x]
        results.append(posterior*100.0)

    normalised_results = normalise(results)
    return jsonify({'results': normalised_results})

def normalise(results):
    normalised_results = []
    summed_results = sum(results)
    for r in results:
        value = r
        norm = value/summed_results
        normalised_results.append(norm*100)

    return normalised_results






if __name__ == '__main__':
    app.run(debug = True)